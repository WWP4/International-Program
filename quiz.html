<main class="wrap">
  <!-- Header -->
  <header class="head" data-aos="fade-up">
    <p class="eyebrow">Revenue • Enrollment • Global Impact</p>
    <h1 class="title">See How Much New Tuition Your School Could Earn This Year</h1>
    <p class="lead">
      Take this 2-minute quiz to get a <strong>custom revenue forecast</strong>, a <strong>board-ready launch plan</strong>, and clear next steps.
      Instant results delivered to your inbox.
    </p>
    <p class="help" style="margin-top:6px">Trusted by schools for 20+ years • Visa-aligned • Board-approved frameworks</p>
  </header>

  <!-- Quiz Card -->
  <section class="card" aria-label="Quick quiz">
    <div class="bar" aria-hidden="true"><span id="progress"></span></div>

    <form id="quizForm" class="quiz" novalidate>
      <!-- STEP 1 -->
      <section class="step active" data-step="1" data-aos="fade-up" aria-labelledby="step1-title">
        <p class="help">Step 1 of 3 — Contact & Role</p>
        <div class="grid" style="margin-top:6px">
          <div>
            <label for="name">Your name</label>
            <input id="name" name="name" type="text" placeholder="Full name" required>
          </div>
          <div>
            <label for="email">Work email</label>
            <input id="email" name="email" type="email" placeholder="name@school.org" required>
          </div>
          <div>
            <label for="school">School</label>
            <input id="school" name="school" type="text" placeholder="School name" required>
          </div>
          <div>
            <label for="role">Your role</label>
            <select id="role" name="role" required>
              <option value="">Select…</option>
              <option>Head of School</option>
              <option>Principal</option>
              <option>Admissions</option>
              <option>Board Member</option>
              <option>Other</option>
            </select>
          </div>
        </div>
        <p class="help">We’ll email your personalized plan immediately after you finish.</p>
        <div class="nav">
          <button type="button" class="btn btn--ghost" disabled>Back</button>
          <button type="button" class="btn btn--primary" id="next1">Continue</button>
        </div>
      </section>

      <!-- STEP 2 -->
      <section class="step" data-step="2" data-aos="fade-up" aria-labelledby="step2-title">
        <p class="help">Step 2 of 3 — Goals & Timing</p>
        <div class="grid" style="margin-top:6px">
          <div>
            <label>Primary goals</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="goal" value="Board approval"> Board approval</label>
              <label class="chip"><input type="checkbox" name="goal" value="Recruiting"> Recruiting</label>
              <label class="chip"><input type="checkbox" name="goal" value="Raises"> Fund teacher raises</label>
              <label class="chip"><input type="checkbox" name="goal" value="Culture"> Protect culture</label>
            </div>
          </div>
          <div>
            <label>Target launch window</label>
            <select name="launch_window" required>
              <option value="">Select…</option>
              <option>Next 90 days</option>
              <option>Next 6 months</option>
              <option>This school year</option>
              <option>Next school year</option>
            </select>
          </div>
        </div>
        <div class="grid">
          <div>
            <label>Estimated international cohort size</label>
            <select name="cohort" required>
              <option value="">Select…</option>
              <option>5–10</option>
              <option>10–15</option>
              <option>15–25</option>
              <option>25+</option>
            </select>
          </div>
          <div>
            <label>Do you already have host families?</label>
            <select name="hosts" required>
              <option value="">Select…</option>
              <option>Yes — ready list</option>
              <option>Some — need more</option>
              <option>No — need to recruit</option>
            </select>
          </div>
        </div>
        <div class="nav">
          <button type="button" class="btn btn--ghost" id="back2">Back</button>
          <button type="button" class="btn btn--primary" id="next2">Continue</button>
        </div>
      </section>

      <!-- STEP 3 -->
      <section class="step" data-step="3" data-aos="fade-up" aria-labelledby="step3-title">
        <p class="help">Step 3 of 3 — Risks & Readiness</p>
        <div class="grid" style="margin-top:6px">
          <div>
            <label for="concern">Biggest concern</label>
            <select id="concern" name="concern" required>
              <option value="">Select…</option>
              <option>Compliance & risk</option>
              <option>Recruiting & agents</option>
              <option>ESL & student supports</option>
              <option>Budget & timing</option>
            </select>
          </div>
          <div>
            <label for="timeframe">When would you like to start?</label>
            <select id="timeframe" name="timeframe" required>
              <option value="">Select…</option>
              <option>Immediately</option>
              <option>Within 30 days</option>
              <option>60–90 days</option>
              <option>Undecided</option>
            </select>
          </div>
        </div>
        <div>
          <label for="notes">Anything else we should know?</label>
          <textarea id="notes" name="notes" placeholder="Optional"></textarea>
        </div>
        <div class="nav">
          <button type="button" class="btn btn--ghost" id="back3">Back</button>
          <button type="submit" class="btn btn--primary" id="submitBtn">Get My Plan</button>
        </div>
        <p class="help" style="margin-top:10px">Private and secure. We never share your information.</p>
      </section>
    </form>

    <!-- Success -->
    <div id="success" class="success" aria-live="polite">
      <h2 class="succ__title">Your Preliminary Plan Is Ready</h2>
      <div class="succ__card">
        You’re pre-qualified for our Fall Launch cohort. To secure your onboarding window, choose a next step below.
        <div style="margin-top:12px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
          <a class="btn btn--primary" href="https://calendly.com/melissa-cnu/30min" target="_blank" rel="noopener">Book My Launch Call</a>
          <a class="btn btn--ghost" href="https://buy.stripe.com/fZu8wPdJX6QO0fQ6Cw8so00" target="_blank" rel="noopener">Place Deposit</a>
        </div>
        <p class="help" style="margin-top:10px">You’ll also receive a board-ready one-pager with your revenue forecast and next steps.</p>
      </div>
      <p class="help" style="margin-top:12px">White-Glove Partnership • Board-Ready • Visa-Aligned</p>
    </div>
  </section>
</main>


<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<!-- Supabase UMD (must load BEFORE we call createClient) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // ---------- AOS
  if (window.AOS){
    const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    AOS.init({ duration: reduced ? 0 : 900, easing: 'ease', offset: 80, once: true, disable: reduced });
  }

  // Guard: ensure Supabase UMD loaded
  if (!window.supabase) {
    console.error("Supabase UMD failed to load (check the Network tab).");
    // We don't early return, but inserts will fail; this helps you debug quickly.
  }

  // ---------- Supabase client
  const SUPABASE_URL = "https://gdwodqwhjrksjhxazuio.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdkd29kcXdoanJrc2poeGF6dWlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzMTU3NzcsImV4cCI6MjA2Njg5MTc3N30.Zq0lZRK6X6vVVwdhqkNVwMLsGPOhDFrYoEyUwtkbG0o";
  const sb = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // ---------- Simple stepper
  const steps = Array.from(document.querySelectorAll('.step'));
  const prog  = document.getElementById('progress');
  let idx = 0;
  function setStep(n){
    idx = Math.max(0, Math.min(n, steps.length-1));
    steps.forEach((s,i)=>s.classList.toggle('active', i===idx));
    prog.style.width = ((idx+1)/steps.length*100) + '%';
    const card = document.querySelector('.card');
    if (card) {
      const top = card.offsetTop - 24;
      window.scrollTo({top, behavior:'smooth'});
    }
  }
  document.getElementById('next1').addEventListener('click', ()=>{
    const ok = ['name','email','school','role'].every(id=>document.getElementById(id).checkValidity());
    if(!ok){ document.getElementById('quizForm').reportValidity(); return; }
    setStep(1);
  });
  document.getElementById('back2').addEventListener('click', ()=>setStep(0));
  document.getElementById('next2').addEventListener('click', ()=>{
    const f = document.getElementById('quizForm');
    const ok = f.querySelector('select[name="launch_window"]').checkValidity()
             && f.querySelector('select[name="cohort"]').checkValidity()
             && f.querySelector('select[name="hosts"]').checkValidity();
    if(!ok){ f.reportValidity(); return; }
    setStep(2);
  });
  document.getElementById('back3').addEventListener('click', ()=>setStep(1));

  // ---------- Submit
  const form = document.getElementById('quizForm');
  const submitBtn = document.getElementById('submitBtn');
  const success = document.getElementById('success');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    submitBtn.disabled = true; submitBtn.textContent = 'Submitting…';

    // collect goals
    const goals = Array.from(form.querySelectorAll('input[name="goal"]:checked')).map(i=>i.value);

    const payload = {
      name:        document.getElementById('name').value || null,
      email:       document.getElementById('email').value || null,
      school:      document.getElementById('school').value || null,
      role:        document.getElementById('role').value || null,
      goals, // text[]
      launch_window: form.querySelector('[name="launch_window"]').value || null,
      cohort:        form.querySelector('[name="cohort"]').value || null,
      hosts:         form.querySelector('[name="hosts"]').value || null,
      concern:       document.getElementById('concern').value || null,
      timeframe:     document.getElementById('timeframe').value || null,
      notes:         document.getElementById('notes').value || null,
      origin_url:    location.href,
      utm_source:    new URLSearchParams(location.search).get('utm_source'),
      utm_medium:    new URLSearchParams(location.search).get('utm_medium'),
      utm_campaign:  new URLSearchParams(location.search).get('utm_campaign'),
      utm_content:   new URLSearchParams(location.search).get('utm_content'),
      utm_term:      new URLSearchParams(location.search).get('utm_term')
    };

    try{
      if (!sb) throw new Error("Supabase client not initialized.");
      const { error } = await sb.from('quiz_submissions').insert([payload]); // array insert

      if (error) throw error;

      document.querySelector('.card').style.display = 'none';
      success.classList.add('show');
    }catch(err){
      console.error('Supabase insert error:', err);
      alert('Submission failed. Please try again or email melissa@grantlegacybuilders.com');
      submitBtn.disabled = false; submitBtn.textContent = 'Submit Quiz';
    }
  });

  // init step bar
  setStep(0);
});
</script>
</body>
</html>
